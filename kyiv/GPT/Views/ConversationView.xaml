<?xml version="1.0" encoding="UTF-8" ?>
<?xaml-comp compile="true" ?>
<ContentPage
    x:Class="ChatGPT.Views.ConversationView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:templates="clr-namespace:ChatGPT.Views.Templates"
    xmlns:viewmodel="clr-namespace:ChatGPT.ViewModels"
    x:Name="mainPage"
    x:DataType="viewmodel:ConversationViewModel"

    BackgroundColor="{AppThemeBinding Light={StaticResource White},
                                      Dark={StaticResource Black}}"
    >

    <ContentPage.Resources>
        <DataTemplate x:Key="UserMessageItemTemplate">
            <templates:UserMessageItemTemplate />
        </DataTemplate>

        <DataTemplate x:Key="BotMessageItemTemplate">
            <templates:BotMessageItemTemplate />
        </DataTemplate>

        <templates:MessageDataTemplateSelector
            x:Key="MessageDataTemplateSelector"
            BotMessageTemplate="{StaticResource BotMessageItemTemplate}"
            UserMessageItemTemplate="{StaticResource UserMessageItemTemplate}"
             />
    </ContentPage.Resources>


   <Grid Background="Transparent"  RowDefinitions="*, Auto">

        <Border
            Grid.Row="0" 
            Padding="16,0,16,7"
            BackgroundColor="{AppThemeBinding Light={StaticResource White},
                                              Dark={StaticResource Black}}"
            StrokeShape="RoundRectangle 0,0,15,15"
            StrokeThickness="0">
            <CollectionView
                x:Name="myCollectionView"
                ItemTemplate="{StaticResource MessageDataTemplateSelector}"
                ItemsSource="{Binding Messages}">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout
                        ItemSpacing="20"
                        Orientation="Vertical" />
                </CollectionView.ItemsLayout>

            </CollectionView>
        </Border>



        <Grid BackgroundColor="Transparent"
            Grid.Row="1"
            Padding="10,0" 
            ColumnDefinitions="*, Auto"
            ColumnSpacing="10">
            <Border
                Grid.Column="0"
                BackgroundColor="{AppThemeBinding Light={StaticResource QuinaryLight},
                                                  Dark={StaticResource QuinaryDark}}"
                HeightRequest="48"
                StrokeShape="RoundRectangle 36,36,36,36"
                StrokeThickness="0">

                    <Entry
                        x:Name="QuestionEntry"
                        Margin="16,0"
                        Placeholder="Enter text here..."
                        Style="{StaticResource TxtSubtitle2_3}"
                        Text="{Binding Query}"
                        TranslationY="4" />

            </Border>

            <Border
                Grid.Column="1"
                BackgroundColor="{AppThemeBinding Light={StaticResource QuinaryLight},
                                                  Dark={StaticResource QuinaryDark}}"
                HeightRequest="48"
                StrokeShape="{OnPlatform WinUI='RoundRectangle 10,10,10,10',
                                         MacCatalyst='RoundRectangle 10,10,10,10',
                                         Default='RoundRectangle 24,24,24,24'}"
                StrokeThickness="0"
                WidthRequest="48">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding CurrentCommand}" />
                </Border.GestureRecognizers>

                <Image
                    HeightRequest="35"
                    Source="send.png"
                    WidthRequest="35" />
            </Border>


        </Grid>

    </Grid>

</ContentPage>